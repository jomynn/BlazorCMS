@page "/login"
@inject HttpClient Http
@inject CustomAuthStateProvider AuthProvider
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider

<h3>Admin Login</h3>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}

<div class="login-container">
    <label>Email:</label>
    <input @bind="email" class="form-control" />

    <label>Password:</label>
    <input @bind="password" type="password" class="form-control" />

    <button class="btn btn-primary mt-2" @onclick="AdminLogin">Admin Login</button>
</div>

@code {
    private string email;
    private string password;
    private string errorMessage;

    private async Task AdminLogin()
    {
        var loginModel = new { Email = email, Password = password };
        var response = await Http.PostAsJsonAsync("https://localhost:7250/api/auth/login", loginModel);

        if (response.IsSuccessStatusCode)
        {
            var result = await response.Content.ReadFromJsonAsync<LoginResponse>();
            await AuthProvider.SetAuthToken(result.Token);
            Navigation.NavigateTo("/", true);
        }
        else
        {
            errorMessage = "Invalid login credentials.";
        }
    }

    private class LoginResponse
    {
        public string Token { get; set; }
    }
}
